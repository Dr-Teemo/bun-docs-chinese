---
title: "ç¼–å†™æµ‹è¯•"
description: "å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Bun çš„ Jest å…¼å®¹ API ç¼–å†™æµ‹è¯•ï¼Œæ”¯æŒå¼‚æ­¥æµ‹è¯•ã€è¶…æ—¶å’Œå„ç§æµ‹è¯•ä¿®é¥°ç¬¦"
---

ä½¿ç”¨ä»å†…ç½® bun:test æ¨¡å—å¯¼å…¥çš„ç±»ä¼¼ Jest çš„ API å®šä¹‰æµ‹è¯•ã€‚ä»é•¿è¿œæ¥çœ‹ï¼ŒBun æ—¨åœ¨å®ç°å®Œå…¨çš„ Jest å…¼å®¹æ€§ï¼›ç›®å‰ï¼Œä»…æ”¯æŒæœ‰é™çš„ expect åŒ¹é…å™¨é›†åˆã€‚

## åŸºæœ¬ç”¨æ³•

å®šä¹‰ä¸€ä¸ªç®€å•æµ‹è¯•ï¼š

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 + 2", () => {
  expect(2 + 2).toBe(4);
});
```

### åˆ†ç»„æµ‹è¯•

æµ‹è¯•å¯ä»¥ç”¨ describe åˆ†ç»„æˆå¥—ä»¶ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test, describe } from "bun:test";

describe("arithmetic", () => {
  test("2 + 2", () => {
    expect(2 + 2).toBe(4);
  });

  test("2 * 2", () => {
    expect(2 * 2).toBe(4);
  });
});
```

### å¼‚æ­¥æµ‹è¯•

æµ‹è¯•å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 * 2", async () => {
  const result = await Promise.resolve(2 * 2);
  expect(result).toEqual(4);
});
```

æˆ–è€…ï¼Œä½¿ç”¨ done å›è°ƒæ¥è¡¨ç¤ºå®Œæˆã€‚å¦‚æœæ‚¨åœ¨æµ‹è¯•å®šä¹‰ä¸­åŒ…å« done å›è°ƒä½œä¸ºå‚æ•°ï¼Œæ‚¨å¿…é¡»è°ƒç”¨å®ƒï¼Œå¦åˆ™æµ‹è¯•å°†æŒ‚èµ·ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 * 2", done => {
  Promise.resolve(2 * 2).then(result => {
    expect(result).toEqual(4);
    done();
  });
});
```

## è¶…æ—¶

é€šè¿‡å°†æ•°å­—ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ testï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šæ¯ä¸ªæµ‹è¯•çš„è¶…æ—¶æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test("wat", async () => {
  const data = await slowOperation();
  expect(data).toBe(42);
}, 500); // æµ‹è¯•å¿…é¡»åœ¨ <500ms å†…è¿è¡Œ
```

åœ¨ bun:test ä¸­ï¼Œæµ‹è¯•è¶…æ—¶ä¼šæŠ›å‡ºä¸€ä¸ªä¸å¯æ•è·çš„å¼‚å¸¸ä»¥å¼ºåˆ¶æµ‹è¯•åœæ­¢è¿è¡Œå¹¶å¤±è´¥ã€‚æˆ‘ä»¬è¿˜ä¼šæ€æ­»åœ¨æµ‹è¯•ä¸­ç”Ÿæˆçš„ä»»ä½•å­è¿›ç¨‹ï¼Œä»¥é¿å…ç•™ä¸‹åƒµå°¸è¿›ç¨‹åœ¨åå°æ½œä¼ã€‚

å¦‚æœæœªé€šè¿‡æ­¤è¶…æ—¶é€‰é¡¹æˆ– jest.setDefaultTimeout() è¦†ç›–ï¼Œé»˜è®¤æ¯ä¸ªæµ‹è¯•çš„è¶…æ—¶æ—¶é—´ä¸º 5000msï¼ˆ5 ç§’ï¼‰ã€‚

## é‡è¯•å’Œé‡å¤

### test.retry

ä½¿ç”¨ retry é€‰é¡¹åœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚å¦‚æœåœ¨æŒ‡å®šçš„å°è¯•æ¬¡æ•°å†…æˆåŠŸï¼Œæµ‹è¯•å°±é€šè¿‡ã€‚è¿™å¯¹äºå¯èƒ½é—´æ­‡æ€§å¤±è´¥çš„ä¸ç¨³å®šçš„æµ‹è¯•å¾ˆæœ‰ç”¨ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test(
  "flaky network request",
  async () => {
    const response = await fetch("https://example.com/api");
    expect(response.ok).toBe(true);
  },
  { retry: 3 }, // å¦‚æœæµ‹è¯•å¤±è´¥æœ€å¤šé‡è¯• 3 æ¬¡
);
```

### test.repeats

ä½¿ç”¨ repeats é€‰é¡¹è¿è¡Œæµ‹è¯•å¤šæ¬¡ï¼Œæ— è®ºé€šè¿‡/å¤±è´¥çŠ¶æ€å¦‚ä½•ã€‚å¦‚æœä»»ä½•è¿­ä»£å¤±è´¥ï¼Œæµ‹è¯•å°±å¤±è´¥ã€‚è¿™å¯¹äºæ£€æµ‹ä¸ç¨³å®šçš„æµ‹è¯•æˆ–å‹åŠ›æµ‹è¯•å¾ˆæœ‰ç”¨ã€‚æ³¨æ„ repeats: N æ€»å…±è¿è¡Œ N+1 æ¬¡ï¼ˆ1 æ¬¡åˆå§‹è¿è¡Œ + N æ¬¡é‡å¤ï¼‰ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test(
  "ensure test is stable",
  () => {
    expect(Math.random()).toBeLessThan(1);
  },
  { repeats: 20 }, // æ€»å…±è¿è¡Œ 21 æ¬¡ï¼ˆ1 æ¬¡åˆå§‹ + 20 æ¬¡é‡å¤ï¼‰
);
```

<Note>æ‚¨ä¸èƒ½åœ¨åŒä¸€æµ‹è¯•ä¸­åŒæ—¶ä½¿ç”¨ `retry` å’Œ `repeats`ã€‚</Note>

### ğŸ§Ÿ åƒµå°¸è¿›ç¨‹æ€æ‰‹

å½“æµ‹è¯•è¶…æ—¶å¹¶ä¸”é€šè¿‡ Bun.spawnã€Bun.spawnSync æˆ– node:child_process åœ¨æµ‹è¯•ä¸­ç”Ÿæˆçš„è¿›ç¨‹æ²¡æœ‰è¢«æ€æ­»æ—¶ï¼Œå®ƒä»¬å°†è¢«è‡ªåŠ¨æ€æ­»ï¼Œå¹¶å°†æ¶ˆæ¯è®°å½•åˆ°æ§åˆ¶å°ã€‚è¿™å¯ä»¥é˜²æ­¢è¶…æ—¶æµ‹è¯•ååƒµå°¸è¿›ç¨‹åœ¨åå°æ½œä¼ã€‚

## æµ‹è¯•ä¿®é¥°ç¬¦

### test.skip

ä½¿ç”¨ test.skip è·³è¿‡å•ä¸ªæµ‹è¯•ã€‚è¿™äº›æµ‹è¯•ä¸ä¼šè¿è¡Œã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test.skip("wat", () => {
  // TODO: ä¿®å¤è¿™ä¸ªé—®é¢˜
  expect(0.1 + 0.2).toEqual(0.3);
});
```

### test.todo

ä½¿ç”¨ test.todo å°†æµ‹è¯•æ ‡è®°ä¸ºå¾…åŠäº‹é¡¹ã€‚è¿™äº›æµ‹è¯•ä¸ä¼šè¿è¡Œã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test.todo("fix this", () => {
  myTestFunction();
});
```

è¦è¿è¡Œå¾…åŠæµ‹è¯•å¹¶æŸ¥æ‰¾ä»»ä½•é€šè¿‡çš„æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ `bun test --todo`ã€‚

```bash terminal icon="terminal"
bun test --todo
```

```
my.test.ts:
âœ— unimplemented feature
  ^ this test is marked as todo but passes. Remove `.todo` or check that test is correct.

 0 pass
 1 fail
 1 expect() calls
```

ä½¿ç”¨æ­¤æ ‡å¿—ï¼Œå¤±è´¥çš„å¾…åŠæµ‹è¯•ä¸ä¼šå¯¼è‡´é”™è¯¯ï¼Œä½†é€šè¿‡çš„å¾…åŠæµ‹è¯•å°†è¢«æ ‡è®°ä¸ºå¤±è´¥ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥åˆ é™¤å¾…åŠæ ‡è®°æˆ–ä¿®å¤æµ‹è¯•ã€‚

### test.only

è¦è¿è¡Œç‰¹å®šæµ‹è¯•æˆ–æµ‹è¯•å¥—ä»¶ï¼Œè¯·ä½¿ç”¨ test.only() æˆ– describe.only()ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test, describe } from "bun:test";

test("test #1", () => {
  // ä¸è¿è¡Œ
});

test.only("test #2", () => {
  // è¿è¡Œ
});

describe.only("only", () => {
  test("test #3", () => {
    // è¿è¡Œ
  });
});
```

ä»¥ä¸‹å‘½ä»¤å°†ä»…æ‰§è¡Œæµ‹è¯• #2 å’Œ #3ã€‚

```bash terminal icon="terminal"
bun test --only
```

ä»¥ä¸‹å‘½ä»¤å°†ä»…æ‰§è¡Œæµ‹è¯• #1ã€#2 å’Œ #3ã€‚

```bash terminal icon="terminal"
bun test
```

### test.if

è¦æ ¹æ®æ¡ä»¶è¿è¡Œæµ‹è¯•ï¼Œè¯·ä½¿ç”¨ test.if()ã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸå€¼ï¼Œåˆ™æµ‹è¯•å°†è¿è¡Œã€‚è¿™å¯¹äºä»…åº”åœ¨ç‰¹å®šæ¶æ„æˆ–æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æµ‹è¯•ç‰¹åˆ«æœ‰ç”¨ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
test.if(Math.random() > 0.5)("runs half the time", () => {
  // ...
});

const macOS = process.platform === "darwin";
test.if(macOS)("runs on macOS", () => {
  // å¦‚æœ macOS è¿è¡Œ
});
```

### test.skipIf

è¦åŸºäºæŸäº›æ¡ä»¶è·³è¿‡æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ test.skipIf() æˆ– describe.skipIf()ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
const macOS = process.platform === "darwin";

test.skipIf(macOS)("runs on non-macOS", () => {
  // å¦‚æœ*ä¸æ˜¯* macOS è¿è¡Œ
});
```

### test.todoIf

å¦‚æœè¦å°†æµ‹è¯•æ ‡è®°ä¸º TODOï¼Œè¯·ä½¿ç”¨ test.todoIf() æˆ– describe.todoIf()ã€‚ä»”ç»†é€‰æ‹© skipIf æˆ– todoIf å¯ä»¥æ˜¾ç¤º"å¯¹æ­¤ç›®æ ‡æ— æ•ˆ"å’Œ"è®¡åˆ’ä½†å°šæœªå®ç°"ä¹‹é—´çš„æ„å›¾å·®å¼‚ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
const macOS = process.platform === "darwin";

// TODO: æˆ‘ä»¬åªåœ¨ Linux ä¸Šå®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚
test.todoIf(macOS)("runs on posix", () => {
  // å¦‚æœ*ä¸æ˜¯* macOS è¿è¡Œ
});
```

### test.failing

å½“æ‚¨çŸ¥é“æµ‹è¯•å½“å‰å¤±è´¥ä½†å¸Œæœ›è·Ÿè¸ªå®ƒå¹¶åœ¨å®ƒå¼€å§‹é€šè¿‡æ—¶æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œè¯·ä½¿ç”¨ test.failing()ã€‚è¿™ä¼šåè½¬æµ‹è¯•ç»“æœï¼š

- æ ‡è®°ä¸º `.failing()` çš„å¤±è´¥æµ‹è¯•å°†é€šè¿‡
- æ ‡è®°ä¸º `.failing()` çš„é€šè¿‡æµ‹è¯•å°†å¤±è´¥ï¼ˆå¸¦æœ‰æ¶ˆæ¯è¡¨æ˜å®ƒç°åœ¨é€šè¿‡äº†ï¼Œåº”è¯¥ä¿®å¤ï¼‰

```ts math.test.ts icon="/icons/typescript.svg"
// è¿™å°†é€šè¿‡ï¼Œå› ä¸ºæµ‹è¯•æŒ‰é¢„æœŸå¤±è´¥
test.failing("math is broken", () => {
  expect(0.1 + 0.2).toBe(0.3); // ç”±äºæµ®ç‚¹ç²¾åº¦è€Œå¤±è´¥
});

// è¿™å°†å¤±è´¥å¹¶æ˜¾ç¤ºæµ‹è¯•ç°åœ¨é€šè¿‡çš„æ¶ˆæ¯
test.failing("fixed bug", () => {
  expect(1 + 1).toBe(2); // é€šè¿‡ï¼Œä½†æˆ‘ä»¬æœŸæœ›å®ƒå¤±è´¥
});
```

è¿™å¯¹äºè·Ÿè¸ªè®¡åˆ’ç¨åä¿®å¤çš„å·²çŸ¥é”™è¯¯ï¼Œæˆ–ç”¨äºå®ç°æµ‹è¯•é©±åŠ¨å¼€å‘å¾ˆæœ‰ç”¨ã€‚

## æè¿°å—çš„æ¡ä»¶æµ‹è¯•

æ¡ä»¶ä¿®é¥°ç¬¦ .if()ã€.skipIf() å’Œ .todoIf() ä¹Ÿå¯ä»¥åº”ç”¨äºæè¿°å—ï¼Œå½±å“å¥—ä»¶ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
const isMacOS = process.platform === "darwin";

// ä»…åœ¨ macOS ä¸Šè¿è¡Œæ•´ä¸ªå¥—ä»¶
describe.if(isMacOS)("macOS-specific features", () => {
  test("feature A", () => {
    // ä»…åœ¨ macOS ä¸Šè¿è¡Œ
  });

  test("feature B", () => {
    // ä»…åœ¨ macOS ä¸Šè¿è¡Œ
  });
});

// åœ¨ Windows ä¸Šè·³è¿‡æ•´ä¸ªå¥—ä»¶
describe.skipIf(process.platform === "win32")("Unix features", () => {
  test("feature C", () => {
    // åœ¨ Windows ä¸Šè·³è¿‡
  });
});

// åœ¨ Linux ä¸Šå°†æ•´ä¸ªå¥—ä»¶æ ‡è®°ä¸º TODO
describe.todoIf(process.platform === "linux")("Upcoming Linux support", () => {
  test("feature D", () => {
    // åœ¨ Linux ä¸Šæ ‡è®°ä¸º TODO
  });
});
```

## å‚æ•°åŒ–æµ‹è¯•

### test.each å’Œ describe.each

è¦ä½¿ç”¨å¤šç»„æ•°æ®è¿è¡Œç›¸åŒçš„æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ test.eachã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªå‚æ•°åŒ–æµ‹è¯•ï¼Œä¸ºæä¾›çš„æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¸€æ¬¡ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
const cases = [
  [1, 2, 3],
  [3, 4, 7],
];

test.each(cases)("%p + %p should be %p", (a, b, expected) => {
  expect(a + b).toBe(expected);
});
```

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ describe.each åˆ›å»ºå‚æ•°åŒ–å¥—ä»¶ï¼Œä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¸€æ¬¡ï¼š

```ts title="sum.test.ts" icon="/icons/typescript.svg"
describe.each([
  [1, 2, 3],
  [3, 4, 7],
])("add(%i, %i)", (a, b, expected) => {
  test(`returns ${expected}`, () => {
    expect(a + b).toBe(expected);
  });

  test(`sum is greater than each value`, () => {
    expect(a + b).toBeGreaterThan(a);
    expect(a + b).toBeGreaterThan(b);
  });
});
```

### å‚æ•°ä¼ é€’

å‚æ•°å¦‚ä½•ä¼ é€’ç»™æ‚¨çš„æµ‹è¯•å‡½æ•°å–å†³äºæµ‹è¯•ç”¨ä¾‹çš„ç»“æ„ï¼š

- å¦‚æœè¡¨è¡Œæ˜¯æ•°ç»„ï¼ˆå¦‚ [1, 2, 3]ï¼‰ï¼Œåˆ™æ¯ä¸ªå…ƒç´ ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’
- å¦‚æœè¡Œä¸æ˜¯æ•°ç»„ï¼ˆå¦‚å¯¹è±¡ï¼‰ï¼Œåˆ™ä½œä¸ºå•ä¸ªå‚æ•°ä¼ é€’

```ts title="example.test.ts" icon="/icons/typescript.svg"
// æ•°ç»„é¡¹ä½œä¸ºå•ç‹¬å‚æ•°ä¼ é€’
test.each([
  [1, 2, 3],
  [4, 5, 9],
])("add(%i, %i) = %i", (a, b, expected) => {
  expect(a + b).toBe(expected);
});

// å¯¹è±¡é¡¹ä½œä¸ºå•ä¸ªå‚æ•°ä¼ é€’
test.each([
  { a: 1, b: 2, expected: 3 },
  { a: 4, b: 5, expected: 9 },
])("add($a, $b) = $expected", data => {
  expect(data.a + data.b).toBe(data.expected);
});
```

### æ ¼å¼è¯´æ˜ç¬¦

æœ‰å¤šç§é€‰é¡¹å¯ç”¨äºæ ¼å¼åŒ–æµ‹è¯•æ ‡é¢˜ï¼š

| è¯´æ˜ç¬¦ | æè¿°             |
| ------ | ---------------- |
| `%p`   | pretty-format    |
| `%s`   | String           |
| `%d`   | Number           |
| `%i`   | Integer          |
| `%f`   | Floating point   |
| `%j`   | JSON             |
| `%o`   | Object           |
| `%#`   | æµ‹è¯•ç”¨ä¾‹çš„ç´¢å¼•   |
| `%%`   | å•ä¸ªç™¾åˆ†å· (%)   |

#### ç¤ºä¾‹

```ts title="example.test.ts" icon="/icons/typescript.svg"
// åŸºæœ¬è¯´æ˜ç¬¦
test.each([
  ["hello", 123],
  ["world", 456],
])("string: %s, number: %i", (str, num) => {
  // "string: hello, number: 123"
  // "string: world, number: 456"
});

// %p ç”¨äºæ¼‚äº®æ ¼å¼è¾“å‡º
test.each([
  [{ name: "Alice" }, { a: 1, b: 2 }],
  [{ name: "Bob" }, { x: 5, y: 10 }],
])("user %p with data %p", (user, data) => {
  // "user { name: 'Alice' } with data { a: 1, b: 2 }"
  // "user { name: 'Bob' } with data { x: 5, y: 10 }"
});

// %# ç”¨äºç´¢å¼•
test.each(["apple", "banana"])("fruit #%# is %s", fruit => {
  // "fruit #0 is apple"
  // "fruit #1 is banana"
});
```

## æ–­è¨€è®¡æ•°

Bun æ”¯æŒéªŒè¯æµ‹è¯•æœŸé—´è°ƒç”¨äº†ç‰¹å®šæ•°é‡çš„æ–­è¨€ï¼š

### expect.hasAssertions()

ä½¿ç”¨ expect.hasAssertions() éªŒè¯æµ‹è¯•æœŸé—´è‡³å°‘è°ƒç”¨äº†ä¸€ä¸ªæ–­è¨€ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("async work calls assertions", async () => {
  expect.hasAssertions(); // å¦‚æœæ²¡æœ‰è°ƒç”¨æ–­è¨€å°†å¤±è´¥

  const data = await fetchData();
  expect(data).toBeDefined();
});
```

è¿™åœ¨å¼‚æ­¥æµ‹è¯•ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œä»¥ç¡®ä¿æ‚¨çš„æ–­è¨€ç¡®å®è¿è¡Œã€‚

### expect.assertions(count)

ä½¿ç”¨ expect.assertions(count) éªŒè¯æµ‹è¯•æœŸé—´è°ƒç”¨äº†ç‰¹å®šæ•°é‡çš„æ–­è¨€ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("exactly two assertions", () => {
  expect.assertions(2); // å¦‚æœæ²¡æœ‰æ°å¥½è°ƒç”¨ 2 ä¸ªæ–­è¨€å°†å¤±è´¥

  expect(1 + 1).toBe(2);
  expect("hello").toContain("ell");
});
```

è¿™æœ‰åŠ©äºç¡®ä¿æ‰€æœ‰æ–­è¨€éƒ½è¿è¡Œï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰å¤šä¸ªä»£ç è·¯å¾„çš„å¤æ‚å¼‚æ­¥ä»£ç ä¸­ã€‚

## ç±»å‹æµ‹è¯•

Bun åŒ…å« expectTypeOf ç”¨äºæµ‹è¯• TypeScript ç±»å‹ï¼Œä¸ Vitest å…¼å®¹ã€‚

### expectTypeOf

<Warning>
  è¿™äº›å‡½æ•°åœ¨è¿è¡Œæ—¶æ˜¯æ— æ“ä½œ - æ‚¨éœ€è¦å•ç‹¬è¿è¡Œ TypeScript æ¥éªŒè¯ç±»å‹æ£€æŸ¥ã€‚
</Warning>

expectTypeOf å‡½æ•°æä¾›ç”± TypeScript ç±»å‹æ£€æŸ¥å™¨æ£€æŸ¥çš„ç±»å‹çº§æ–­è¨€ã€‚è¦æµ‹è¯•æ‚¨çš„ç±»å‹ï¼š

1. ä½¿ç”¨ expectTypeOf ç¼–å†™ç±»å‹æ–­è¨€
2. è¿è¡Œ `bunx tsc --noEmit` æ£€æŸ¥æ‚¨çš„ç±»å‹æ˜¯å¦æ­£ç¡®

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { expectTypeOf } from "bun:test";

// åŸºæœ¬ç±»å‹æ–­è¨€
expectTypeOf<string>().toEqualTypeOf<string>();
expectTypeOf(123).toBeNumber();
expectTypeOf("hello").toBeString();

// å¯¹è±¡ç±»å‹åŒ¹é…
expectTypeOf({ a: 1, b: "hello" }).toMatchObjectType<{ a: number }>();

// å‡½æ•°ç±»å‹
function greet(name: string): string {
  return `Hello ${name}`;
}

expectTypeOf(greet).toBeFunction();
expectTypeOf(greet).parameters.toEqualTypeOf<[string]>();
expectTypeOf(greet).returns.toEqualTypeOf<string>();

// æ•°ç»„ç±»å‹
expectTypeOf([1, 2, 3]).items.toBeNumber();

// Promise ç±»å‹
expectTypeOf(Promise.resolve(42)).resolves.toBeNumber();
```

æœ‰å…³ expectTypeOf åŒ¹é…å™¨çš„å®Œæ•´æ–‡æ¡£ï¼Œè¯·å‚è§ [API å‚è€ƒ](https://bun.com/reference/bun/test/expectTypeOf)ã€‚

## åŒ¹é…å™¨

Bun å®ç°äº†ä»¥ä¸‹åŒ¹é…å™¨ã€‚å®Œæ•´çš„ Jest å…¼å®¹æ€§åœ¨è·¯çº¿å›¾ä¸Šï¼›[åœ¨æ­¤è·Ÿè¸ªè¿›åº¦](https://github.com/oven-sh/bun/issues/1825)ã€‚

### åŸºæœ¬åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨             |
| ---- | ------------------ |
| âœ…   | .not              |
| âœ…   | .toBe()          |
| âœ…   | .toEqual()       |
| âœ…   | .toBeNull()      |
| âœ…   | .toBeUndefined() |
| âœ…   | .toBeNaN()       |
| âœ…   | .toBeDefined()   |
| âœ…   | .toBeFalsy()     |
| âœ…   | .toBeTruthy()    |
| âœ…   | .toStrictEqual() |

### å­—ç¬¦ä¸²å’Œæ•°ç»„åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                |
| ---- | --------------------- |
| âœ…   | .toContain()        |
| âœ…   | .toHaveLength()     |
| âœ…   | .toMatch()          |
| âœ…   | .toContainEqual()   |
| âœ…   | .stringContaining() |
| âœ…   | .stringMatching()   |
| âœ…   | .arrayContaining()  |

### å¯¹è±¡åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                  |
| ---- | ----------------------- |
| âœ…   | .toHaveProperty()     |
| âœ…   | .toMatchObject()      |
| âœ…   | .toContainAllKeys()   |
| âœ…   | .toContainValue()     |
| âœ…   | .toContainValues()    |
| âœ…   | .toContainAllValues() |
| âœ…   | .toContainAnyValues() |
| âœ…   | .objectContaining()   |

### æ•°å­—åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                      |
| ---- | --------------------------- |
| âœ…   | .toBeCloseTo()            |
| âœ…   | .closeTo()                |
| âœ…   | .toBeGreaterThan()        |
| âœ…   | .toBeGreaterThanOrEqual() |
| âœ…   | .toBeLessThan()           |
| âœ…   | .toBeLessThanOrEqual()    |

### å‡½æ•°å’Œç±»åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨              |
| ---- | ------------------- |
| âœ…   | .toThrow()        |
| âœ…   | .toBeInstanceOf() |

### Promise åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨        |
| ---- | ------------- |
| âœ…   | .resolves() |
| âœ…   | .rejects()  |

### æ¨¡æ‹Ÿå‡½æ•°åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                        |
| ---- | ----------------------------- |
| âœ…   | .toHaveBeenCalled()         |
| âœ…   | .toHaveBeenCalledTimes()    |
| âœ…   | .toHaveBeenCalledWith()     |
| âœ…   | .toHaveBeenLastCalledWith() |
| âœ…   | .toHaveBeenNthCalledWith()  |
| âœ…   | .toHaveReturned()           |
| âœ…   | .toHaveReturnedTimes()      |
| âœ…   | .toHaveReturnedWith()       |
| âœ…   | .toHaveLastReturnedWith()   |
| âœ…   | .toHaveNthReturnedWith()    |

### å¿«ç…§åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                                  |
| ---- | --------------------------------------- |
| âœ…   | .toMatchSnapshot()                    |
| âœ…   | .toMatchInlineSnapshot()              |
| âœ…   | .toThrowErrorMatchingSnapshot()       |
| âœ…   | .toThrowErrorMatchingInlineSnapshot() |

### å®ç”¨å·¥å…·åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨             |
| ---- | ------------------ |
| âœ…   | .extend          |
| âœ…   | .anything()      |
| âœ…   | .any()           |
| âœ…   | .assertions()    |
| âœ…   | .hasAssertions() |

### å°šæœªå®ç°

| çŠ¶æ€ | åŒ¹é…å™¨                     |
| ---- | -------------------------- |
| âŒ   | .addSnapshotSerializer() |

## æœ€ä½³å®è·µ

### ä½¿ç”¨æè¿°æ€§æµ‹è¯•åç§°

```ts title="example.test.ts" icon="/icons/typescript.svg"
// å¥½çš„
test("should calculate total price including tax for multiple items", () => {
  // æµ‹è¯•å®ç°
});

// é¿å…
test("price calculation", () => {
  // æµ‹è¯•å®ç°
});
```

### åˆ†ç»„ç›¸å…³æµ‹è¯•

```ts title="auth.test.ts" icon="/icons/typescript.svg"
describe("User authentication", () => {
  describe("with valid credentials", () => {
    test("should return user data", () => {
      // æµ‹è¯•å®ç°
    });

    test("should set authentication token", () => {
      // æµ‹è¯•å®ç°
    });
  });

  describe("with invalid credentials", () => {
    test("should throw authentication error", () => {
      // æµ‹è¯•å®ç°
    });
  });
});
```

### ä½¿ç”¨é€‚å½“çš„åŒ¹é…å™¨

```ts title="auth.test.ts" icon="/icons/typescript.svg"
// å¥½çš„ï¼šä½¿ç”¨ç‰¹å®šåŒ¹é…å™¨
expect(users).toHaveLength(3);
expect(user.email).toContain("@");
expect(response.status).toBeGreaterThanOrEqual(200);

// é¿å…ï¼šå¯¹æ‰€æœ‰å†…å®¹ä½¿ç”¨ toBe
expect(users.length === 3).toBe(true);
expect(user.email.includes("@")).toBe(true);
expect(response.status >= 200).toBe(true);
```

### æµ‹è¯•é”™è¯¯æ¡ä»¶

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("should throw error for invalid input", () => {
  expect(() => {
    validateEmail("not-an-email");
  }).toThrow("Invalid email format");
});

test("should handle async errors", async () => {
  await expect(async () => {
    await fetchUser("invalid-id");
  }).rejects.toThrow("User not found");
});
```

### ä½¿ç”¨è®¾ç½®å’Œæ¸…ç†

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { beforeEach, afterEach, test } from "bun:test";

let testUser;

beforeEach(() => {
  testUser = createTestUser();
});

afterEach(() => {
  cleanupTestUser(testUser);
});

test("should update user profile", () => {
  // åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ testUser
});
```

